<!DOCTYPE html>
<html>
<head>
	<title>countD</title>
	<script type="text/javascript" src="bower_components/jsTimezoneDetect/jstz.min.js"></script>
	<script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
	<script type="text/javascript" src="bower_components/material-design-lite/material.min.js"></script>
	<script type="text/javascript" src="bower_components/underscore/underscore-min.js"></script>
	<script type="text/javascript" src="bower_components/countdownjs/countdown.min.js"></script>
	<script type="text/javascript" src="bower_components/progressbar.js/dist/progressbar.min.js"></script>
	<script type="text/javascript" src="bower_components/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
	

	<link rel="stylesheet" type="text/css" href="bower_components/material-design-lite/material.min.css">
	<link rel="stylesheet" type="text/css" href="bower_components/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css">
	<link rel="stylesheet" href="https://storage.googleapis.com/code.getmdl.io/1.0.5/material.deep_orange-red.min.css" /> 
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">

	<link href='https://fonts.googleapis.com/css?family=Berkshire+Swash' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

      <style type="text/css">
	      body{
	      	font-family: 'Berkshire Swash', cursive;
	      }

	      .wrapView{
	      	height: 10em;
		    position: absolute;
		    left: 0;
		    right: 0;
		    margin: auto;
	      }

	      .flatView{
	      	background-color: #fefefe;
	      	height: 4em;
	      	color: #fff;
	      	text-align: center;
	      }

	      .dropView{
	      	text-align: center;
	      	background-color: #ededed;
	      	color: #333;
	      	margin: auto;
	      	position: relative;
	      	border-top: 2px solid;
	      	display: none;
	      	padding: 5%;
	      }

	      .navView{
	      	background-color: #333;
	      	text-align: center;
	      	color: #fff;
	      	font-size: 3em;
	      	padding: 2%;
	      	margin-bottom: 5%;
	      }

	      .headerIcon{
	      	width: 2%;
	      }

	      .icon-flipped {
			transform: scaleX(-1);
			-moz-transform: scaleX(-1);
			-webkit-transform: scaleX(-1);
			-ms-transform: scaleX(-1);
			}

			.halfView{
				display: inline-block;
				height: inherit;
				padding-top: 1%;
				font-size: 1.5em;
				background-color: #333;
			}

			.flatLeftDiv{
				border-right: 1px solid;
				width: 49.8%;
				-webkit-transition: width 0.75s ease-in-out;
				-moz-transition: width 0.75s ease-in-out;
				-o-transition: width 0.75s ease-in-out;
				transition: width 0.75s ease-in-out;
			}

			.flatLeftDiv:hover{
				background-color: #fefefe;
				color: #333;
				height: inherit;
				cursor: pointer;
				border-top: 2px solid #333;
			}

			.flatRightDiv{
				border-left: 1px solid;
				width: 49.8%;
				-webkit-transition: width 0.75s ease-in-out;
				-moz-transition: width 0.75s ease-in-out;
				-o-transition: width 0.75s ease-in-out;
				transition: width 0.75s ease-in-out;
			}

			.flatRightDiv:hover{
				background-color: #fefefe;
				color: #333;
				height: inherit;
				cursor: pointer;
				border-top: 2px solid #333;
			}

			.mdl-textfield__label{
				color: #333;
				font-size: 1.5em;
			}

			.mdl-textfield__input{
				border-bottom: 1px solid;
				font-size: 2em;
				text-align: center;
			}

			.__active__{
				background-color: #fefefe;
				color: #333;
				border-top: 2px solid;
			}

			.formTextDiv{
				font-family: monospace;
				display: inline-block;
			}

			.timeWrapperDiv{
				width: 100% !important;
			}

			.customCard{
				display: none;
				margin: auto;
    			margin-top: -15%;
			}

			#closeCustomCard{
				float: right;
				cursor: pointer;
    			margin-right: 5%;
			}

			.customOptions{
				padding: 5%;
			}

			#chooseColor{
				width: 50%;
			}


      </style>

      <script type="text/javascript">
      var selectedTense = 0;
      var leftWidth = 0;
      var rightWidth = 0;
      var isDateValid = false;
      var ampm = 0;

      var vm = this;

      vm.activeTense = 0;

      $(document).ready(function() {
      	$('.halfView').click(function() {
      		selectedTense = $( this ).data('tense');
      		if(selectedTense === 1){
      			if($('#flatRightDiv').hasClass('__active__')){
      				$('#flatRightDiv').removeClass('__active__ mdl-color--primary');
      			}
      			$('#flatLeftDiv').addClass('__active__ mdl-color--primary');
      			leftWidth = '75%';
      			rightWidth = '24%';
      		}else if(selectedTense === 2){
      			if($('#flatLeftDiv').hasClass('__active__')){
      				$('#flatLeftDiv').removeClass('__active__ mdl-color--primary');
      			}
      			$('#flatRightDiv').addClass('__active__ mdl-color--primary');
      			leftWidth = '24%';
      			rightWidth = '75%';
      		}
      		$('#flatLeftDiv').width(leftWidth);
      		$('#flatRightDiv').width(rightWidth);
      		$('.dropView').hide();
      		$('.dropView').fadeIn();

      	});

      	$('#toDate').bind('input propertychange', function() {
				var dateProvided = $(this).val();
				console.log('validDate(dateProvided) ==> ', validDate(dateProvided));
				if (validDate(dateProvided)) {
					console.log('selectedTense == ', selectedTense);
					if (selectedTense == 1) {
						if (pastDate(dateProvided)) {
							$(this).removeClass('invalidInput');
							$('#toDateError').html('');
							$('#toDateFormat').hide();
							isDateValid = true;
						} else {
							$(this).addClass('invalidInput');
							$('#toDateFormat').show();
							$('#toDateError').html('Cannot count from the future');
							isDateValid = false;
						}
					} else if (selectedTense == 2) {
						if (futureDate(dateProvided)) {
							$(this).removeClass('invalidInput');
							$('#toDateError').html('');
							$('#toDateFormat').hide();
							isDateValid = true;
						} else {
							$(this).addClass('invalidInput');
							$('#toDateFormat').show();
							$('#toDateError').html('Cannot count from the future');
							isDateValid = false;
						}

					}
				} else {
					$(this).addClass('invalidInput');
					$('#toDateFormat').show();
					$('#toDateError').html('Please provide a valid date');
					isDateValid = false;
				}
			});

			$('#toHrs').change(function() {
				if ($(this).val() > 12) {
					$(this).val('12');
				} else if ($(this).val() < 0) {
					$(this).val('00');
				} else {
					if ($(this).val().length === 1) {
						var tempHrs = '0' + $(this).val();
						$(this).val(tempHrs);
					} else if ($(this).val().length === 0) {
						$(this).val('00');
					}
				}
			});

			$('#toMins').change(function() {
				if ($(this).val() > 60) {
					$(this).val('00');
				} else if ($(this).val() < 0) {
					$(this).val('00');
				} else {
					if ($(this).val().length === 1) {
						var tempMins = '0' + $(this).val();
						$(this).val(tempMins);
					} else if ($(this).val().length === 0) {
						$(this).val('00');
					}
				}
			});

			$('#selectAmPm').change(function() {
				ampm = $(this).val();
			});

			$('#chooseColor').colorpicker();

			$('#customizeTimer').click(function() {
				$('.customCard').fadeIn();
			});

			$('#closeCustomCard').click(function() {
				$('.customCard').fadeOut();
			});

			$('#startCount').click(function() {
				console.log('validDataForTimer --> ', validDataForTimer());
				if(validDataForTimer()){

					var sinceTill = '';

					if (selectedTense == 1) {
						secondId = setInterval(getPastCounter, 1000);
						sinceTill = 'Since';
					} else if (selectedTense == 2) {
						secondId = setInterval(getFutureCounter, 1000);
						sinceTill = 'Till';
					}

					$('#clockEventName').html($('#countToWhat').val());
					$('#clockTillSince').html(sinceTill);

					_.delay(function(){
						$('#showClock').css('height', $('#showDays').height()*1.2);
						console.log($('#showDays').height()*1.2);
					}, 1000);

					$('.wrapView').fadeOut();
				}else{
					alert('Please provide all required information.');
				}
			});

			$('#switchColor').click(function() {

				var selectedColor = $('#chooseColor').val(); //'rgba(255,146,68,0.63)';

				daysClock.destroy();

				daysClock = new ProgressBar.Circle('#daysClock', {
					duration: 200,
					color: selectedColor,
					trailColor: "#ccc",
					strokeWidth: 2.1,
					trailWidth: 1.0,
					easing: 'easeInOut'
				});

				hoursClock.destroy();

				hoursClock = new ProgressBar.Circle('#hoursClock', {
					duration: 200,
					color: selectedColor,
					trailColor: "#ccc",
					strokeWidth: 2.1,
					trailWidth: 1.0,
					easing: 'easeInOut'
				});

				minutesClock.destroy();

				minutesClock = new ProgressBar.Circle('#minutesClock', {
					duration: 200,
					color: selectedColor,
					trailColor: "#ccc",
					strokeWidth: 2.1,
					trailWidth: 1.0,
					easing: 'easeInOut'
				});

				secondsClock.destroy();

				secondsClock = new ProgressBar.Circle('#secondsClock', {
					duration: 200,
					color: selectedColor,
					trailColor: "#ccc",
					strokeWidth: 2.1,
					trailWidth: 1.0,
					easing: 'easeInOut'
				});

				$('.clockLabel').css('color', selectedColor);
			});


			daysClock = new ProgressBar.Circle('#daysClock', {
				duration: 200,
				color: "#333",
				trailColor: "#ccc",
				strokeWidth: 2.1,
				trailWidth: 1.0,
				easing: 'easeInOut'
			});
			hoursClock = new ProgressBar.Circle('#hoursClock', {
				duration: 200,
				color: "#333",
				trailColor: "#ccc",
				strokeWidth: 2.1,
				trailWidth: 1.0,
				easing: 'easeInOut'
			});
			minutesClock = new ProgressBar.Circle('#minutesClock', {
				duration: 200,
				color: "#333",
				trailColor: "#ccc",
				strokeWidth: 2.1,
				trailWidth: 1.0,
				easing: 'easeInOut'
			});
			secondsClock = new ProgressBar.Circle('#secondsClock', {
				duration: 200,
				color: "#333",
				trailColor: "#ccc",
				strokeWidth: 2.1,
				trailWidth: 1.0,
				easing: 'easeInOut'
			});


			params = getUrlVars();

			if (!_.isEmpty(params)) {
				if (params.stamp !== undefined && !_.isEmpty(params.stamp) && params.tense !== undefined && !_.isEmpty(params.tense)) {
					showReturnClock();
				}
			}

      });

		function validDataForTimer(){
			var timerEvent = $('#theEvent').val();
			var timerDate = $('#toDate').val(); //isDateValid
			var timerHH = $('#toHrs').val();
			var timerMM = $('#toMins').val();
			var timerAMPM = $('#selectAmPm').val();

			if(timerEvent && timerDate && isDateValid && timerHH && timerMM && timerAMPM){
				return true;
			}else{
				return false;
			}

		}

	  	function validDate(dateProvided) {
			var reg = /^(((0[1-9]|[12]\d|3[01])\/(0[13578]|1[02])\/((19|[2-9]\d)\d{2}))|((0[1-9]|[12]\d|30)\/(0[13456789]|1[012])\/((19|[2-9]\d)\d{2}))|((0[1-9]|1\d|2[0-8])\/02\/((19|[2-9]\d)\d{2}))|(29\/02\/((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))))$/g;
			return reg.test(dateProvided);
		}

		function pastDate(dateProvided) {
			var splitDate, dd, mm, yy;
			var todayDate, tDD, tMM, tYY;

			todayDate = new Date();

			tDD = todayDate.getDate();
			tMM = todayDate.getMonth();
			tYY = todayDate.getFullYear();

			splitDate = dateProvided.split('/');
			dd = splitDate[0];
			mm = splitDate[1] - 1;
			yy = splitDate[2];

			if (yy == tYY) {
				if (mm == tMM) {
					if (dd > tDD) {
						return false;
					} else {
						return true;
					}
				} else if (mm > tMM) {
					return false;
				} else if (mm < tMM) {
					return true;
				}
			} else if (yy > tYY) {
				return false;
			} else if (yy < tYY) {
				return true;
			}

		}

		function futureDate(dateProvided) {

			var splitDate, dd, mm, yy;
			var todayDate, tDD, tMM, tYY;

			todayDate = new Date();

			tDD = todayDate.getDate();
			tMM = todayDate.getMonth();
			tYY = todayDate.getFullYear();

			splitDate = dateProvided.split('/');
			dd = splitDate[0];
			mm = splitDate[1] - 1;
			yy = splitDate[2];

			if (yy == tYY) {
				if (mm == tMM) {
					if (dd < tDD) {
						return false;
					} else {
						return true;
					}
				} else if (mm < tMM) {
					return false;
				} else if (mm > tMM) {
					return true;
				}
			} else if (yy < tYY) {
				return false;
			} else if (yy > tYY) {
				return true;
			}


		}

		function getUrlVars() {
			var vars = [],
				hash;
			var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			for (var i = 0; i < hashes.length; i++) {
				hash = hashes[i].split('=');
				vars.push(hash[0]);
				vars[hash[0]] = hash[1];
			}
			return vars;
		}

		function getPastCounter() {
			var dateProvided = $('#toDate').val();
			var hrsProvided = $('#toHrs').val();
			var minsProvided = $('#toMins').val();

			var splitDate, dd, mm, yy, hrs;

			splitDate = dateProvided.split('/');
			dd = splitDate[0];
			mm = splitDate[1] - 1;
			yy = splitDate[2];

			if (ampm === 2) {
				if (hrsProvided === 12) {
					hrs = hrsProvided;
				} else {
					hrs = parseInt(hrsProvided) + 12;
				}
			} else {
				if (hrsProvided === 12) {
					hrs = 0;
				} else {
					hrs = hrsProvided;
				}
			}

			var start = new Date(yy, mm, dd, hrs, minsProvided, 0, 0);
			var end = new Date();

			console.log('start(ts) => ', start.getTime());
			console.log('end =>', end.getTime());

			returnURL = 'http://hemant/countd?stamp=' + start.getTime() + '&tense=2';

			$("#showReturnURL").html(returnURL);

			var cd = countdown(start, end, ~countdown.MILLISECONDS);
			clockText = cd.toString();
			$('#showClockText').html(clockText);
			if (cd.value <= 0) {
				clearInterval(secondId);
			}

			var hours = (cd.hours < 10) ? '0' + cd.hours : cd.hours;
			var minutes = (cd.minutes < 10) ? '0' + cd.minutes : cd.minutes;
			var seconds = (cd.seconds < 10) ? '0' + cd.seconds : cd.seconds;

			days = parseInt(cd.value / 86400000);

			$('.clockDiv').show();

			daysClock.animate(days / days, function() {
				daysClock.setText(days);
			});
			hoursClock.animate(hours / 24, function() {
				hoursClock.setText(hours);
			});
			minutesClock.animate(minutes / 60, function() {
				minutesClock.setText(minutes);
			});
			secondsClock.animate(seconds / 60, function() {
				secondsClock.setText(seconds);
			});

		}

		function getFutureCounter() {
			var dateProvided = $('#toDate').val();
			var hrsProvided = $('#toHrs').val();
			var minsProvided = $('#toMins').val();

			var splitDate, dd, mm, yy, hrs;

			splitDate = dateProvided.split('/');
			dd = splitDate[0];
			mm = splitDate[1] - 1;
			yy = splitDate[2];

			if (ampm === 2) {
				if (hrsProvided === 12) {
					hrs = hrsProvided;
				} else {
					hrs = parseInt(hrsProvided) + 12;
				}
			} else {
				if (hrsProvided === 12) {
					hrs = 0;
				} else {
					hrs = hrsProvided;
				}
			}

			var start = new Date();
			var end = new Date(yy, mm, dd, hrs, minsProvided, 0, 0);

			console.log('start =>', start, start.getTime());
			console.log('end(ts) => ', end, end.getTime());

			returnURL = 'http://hemant/countd?stamp=' + end.getTime() + '&tense=2';
			$("#showReturnURL").html(returnURL);

			var cd = countdown(start, end, ~countdown.MILLISECONDS);
			clockText = cd.toString();
			$('#showClockText').html(clockText);
			if (cd.value <= 0) {
				clearInterval(secondId);
			}

			var hours = (cd.hours < 10) ? '0' + cd.hours : cd.hours;
			var minutes = (cd.minutes < 10) ? '0' + cd.minutes : cd.minutes;
			var seconds = (cd.seconds < 10) ? '0' + cd.seconds : cd.seconds;

			days = parseInt(cd.value / 86400000);

			$('.clockDiv').show();

			daysClock.animate(days / days, function() {
				daysClock.setText(days);
			});
			hoursClock.animate(hours / 24, function() {
				hoursClock.setText(hours);
			});
			minutesClock.animate(minutes / 60, function() {
				minutesClock.setText(minutes);
			});
			secondsClock.animate(seconds / 60, function() {
				secondsClock.setText(seconds);
			});

		}

      </script>

</head>
<body>

<div class="navView">
	<a href="http://hemant/countd/alt.html">
		<i class="material-icons headerIcon  mdl-color-text--primary">timer-sand</i> timekeep.in <i class="material-icons headerIcon icon-flipped  mdl-color-text--primary">timer-sand</i>
	</a>
</div>

<div class="wrapView">
	<div class="flatView">
		<div id="flatLeftDiv" class="flatLeftDiv halfView" data-tense="1">
			<span class="flatText">How long since</span>
		</div>
		<div id="flatRightDiv" class="flatRightDiv halfView" data-tense="2">
			<span class="flatText">How long till</span>
		</div>
	</div>
	<div class="dropView">
	<div class="row">
		<div class="mdl-cell mdl-cell--10-col mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
		    <input class="mdl-textfield__input" type="text" id="theEvent">
		    <label class="mdl-textfield__label viewLabel" for="theEvent">The event</label>
		</div>
	</div>
	<div class="row">
	  <div class="mdl-cell mdl-cell--10-col">
		<div class="formTextDiv mdl-cell mdl-cell--5-col">
	    	<div id="toDateDiv" class="toDiv mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
	    	  <div id="toDateFormat" class="errorMessage">dd/mm/yyyy</div>
	    	  <input class="mdl-textfield__input toDate" maxlength="10" type="text" id="toDate" />
	    	  <label class="mdl-textfield__label" for="toDate">On</label>
	    	  <div id="toDateError" class="errorMessage"></div>
	    	</div>
	    </div>

	    <div class="formTextDiv mdl-cell mdl-cell--5-col">
	      <div class="timeWrapperDiv">
	        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label timeFieldsDiv timeFieldsLeft">
	          <input class="mdl-textfield__input toHrs" type="number" min="0" max="12" maxlength="2" id="toHrs" value="00" />
	          <label class="mdl-textfield__label" for="toHrs">HH</label>
	        </div>
	        <h3 class="DTseparator">:</h3>
	        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label timeFieldsDiv">
	          <input class="mdl-textfield__input toMins" type="number" min="0" max="60" maxlength="2" id="toMins" value="00" />
	          <label class="mdl-textfield__label" for="toMins">MM</label>  
	        </div>
	        <select id="selectAmPm" class="selectAmPm">
	          <option value="1">AM</option>
	          <option value="2">PM</option>
	        </select>
	      </div>
	    </div>

	  </div>
	</div>

	<div class="row">
		<button id="customizeTimer" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
		  Customize timer
		</button>

		<button id="startCount" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
		  Start timing
		</button>
	</div>

	<div class="row">
	    <div class="customCard mdl-card mdl-shadow--2dp">
	    	<span id="closeCustomCard" class="mdl-color-text--primary">x</span>
	    	<div class="customOptions">
	    		<label>Timer color:</label>
	    		<hr>
	    		<input type="text" id="chooseColor">
			    <button id="switchColor" class="mdl-button mdl-js-button mdl-button--primary mdl-js-ripple-effect">
			      Change Color
			    </button>	
	    	</div>
	    	
	    </div>
	</div>
	</div>
</div>


<div id="showClock">
		<div class="clockDiv">
	  	<div id="showDays" class="clocks">
	  		<div id="daysClock"></div>
	  		<div class="clockLabel">Days</div>
	  	</div>
	  	<div id="showHours" class="clocks">
	  		<div id="hoursClock"></div>
	  		<div class="clockLabel">Hours</div>
	  	</div>
	  	<div id="showMinutes" class="clocks">
	  		<div id="minutesClock"></div>
	  		<div class="clockLabel">Minutes</div>
	  	</div>
	  	<div id="showSeconds" class="clocks">
	  		<div id="secondsClock"></div>		
	  		<div class="clockLabel">Seconds</div>
	  	</div>
	  </div>

	  <div id="showReturnURL">
	  	
	  </div>
	</div>


</body>
</html>